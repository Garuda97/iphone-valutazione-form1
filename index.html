<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Valutazione e Prenotazione iPhone</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Helvetica+Neue:400,700&display=swap">
  <style>
    body { font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
    .container { max-width: 900px; margin: 40px auto; padding: 30px; background: #fff; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    h1 { text-align: center; }
    label { display: block; margin-top: 20px; font-weight: 600; }
    select, input, button { width: 100%; padding: 12px; margin-top: 6px; font-size: 16px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
    button { background: #0077cc; color: #fff; font-weight: 700; border: none; cursor: pointer; }
    button:hover { background: #005fa3; }
    .price { text-align: center; font-size: 32px; font-weight: bold; color: #60c100; margin-top: 20px; }
    .note { text-align: center; color: #555; margin-top: 8px; }
    .map { margin-top: 30px; text-align: center; }
    iframe.map-frame { width: 100%; height: 300px; border: none; border-radius: 8px; }
    #confirmation { display: none; margin-top: 30px; background: #e9f7ef; padding: 20px; border-radius: 8px; }
    #langSelect { width: auto; margin: 0 auto; display: block; }
    .lang { display: none; }
    .lang-it { display: inline; }
    .share-btns a { display: inline-block; margin: 5px; padding: 10px; background: #25D366; color: #fff; border-radius: 4px; text-decoration: none; }
    .share-btns a.facebook { background: #3b5998; }
    @media(max-width:600px){.container{margin:20px;padding:20px;} .price{font-size:28px;}}
  </style>
</head>
<body>
  <div class="container">
    <select id="langSelect">
      <option value="it">Italiano</option>
      <option value="en">English</option>
    </select>
    <h1>
      <span class="lang lang-it">Valutazione e Prenota Appuntamento</span>
      <span class="lang lang-en">iPhone Valuation & Appointment Booking</span>
    </h1>

    <!-- Modulo di Valutazione -->
    <label for="modello">
      <span class="lang lang-it">Modello iPhone</span>
      <span class="lang lang-en">iPhone Model</span>
    </label>
    <select id="modello"><option value="">—</option></select>

    <label for="capacita">
      <span class="lang lang-it">Capacità</span>
      <span class="lang lang-en">Capacity</span>
    </label>
    <select id="capacita" disabled><option value="">—</option></select>

    <label for="colore">
      <span class="lang lang-it">Colore</span>
      <span class="lang lang-en">Color</span>
    </label>
    <select id="colore" disabled><option value="">—</option></select>

    <div class="price" id="prezzo">€0,00</div>
    <div class="note">
      <span class="lang lang-it">Prezzo stimato (provvisorio)</span>
      <span class="lang lang-en">Estimated Price (provisional)</span>
    </div>

    <!-- Form di Prenotazione -->
    <form name="booking" method="POST" data-netlify="true" netlify netlify-honeypot="bot-field" id="bookingForm">
      <input type="hidden" name="form-name" value="booking">
      <label for="nome">
        <span class="lang lang-it">Nome</span>
        <span class="lang lang-en">Name</span>
      </label>
      <input type="text" id="nome" name="nome" required>
      <label for="email">
        <span class="lang lang-it">Email</span>
        <span class="lang lang-en">Email</span>
      </label>
      <input type="email" id="email" name="email" required>
      <label for="telefono">
        <span class="lang lang-it">Telefono</span>
        <span class="lang lang-en">Phone</span>
      </label>
      <input type="tel" id="telefono" name="telefono" required>
      <label for="date">
        <span class="lang lang-it">Data preferita</span>
        <span class="lang lang-en">Preferred Date</span>
      </label>
      <input type="date" id="date" name="date" required min="2025-07-25" max="2025-12-31">
      <label for="time">
        <span class="lang lang-it">Ora preferita</span>
        <span class="lang lang-en">Preferred Time</span>
      </label>
      <input type="time" id="time" name="time" required>
      <label>
        <input type="checkbox" id="terms" name="terms" required>
        <span class="lang lang-it">Ho letto e accetto i <a href="/privacy" target="_blank">Termini e Privacy</a></span>
        <span class="lang lang-en">I have read and agree to the <a href="/privacy" target="_blank">Terms & Privacy</a></span>
      </label>
      <input type="hidden" id="hidden-modello" name="modello">
      <input type="hidden" id="hidden-capacita" name="capacita">
      <input type="hidden" id="hidden-colore" name="colore">
      <input type="hidden" id="hidden-prezzo" name="prezzo">
      <input type="hidden" id="hidden-datetime" name="dateTime">
      <button type="submit">
        <span class="lang lang-it">Prenota Appuntamento</span>
        <span class="lang lang-en">Book Appointment</span>
      </button>
    </form>

    <!-- Conferma e PDF -->
    <div id="confirmation">
      <h2>
        <span class="lang lang-it">Conferma Prenotazione</span>
        <span class="lang lang-en">Booking Confirmation</span>
      </h2>
      <p id="confDetails"></p>
      <button id="downloadPdf">
        <span class="lang lang-it">Scarica Ricevuta (PDF)</span>
        <span class="lang lang-en">Download Receipt (PDF)</span>
      </button>
      <div class="share-btns">
        <a href="#" id="whatsappShare" target="_blank">WhatsApp</a>
        <a href="#" id="facebookShare" class="facebook" target="_blank">Facebook</a>
      </div>
    </div>

    <!-- Mappa -->
    <div class="map">
      <h2>
        <span class="lang lang-it">Dove Siamo</span>
        <span class="lang lang-en">Where We Are</span>
      </h2>
      <iframe class="map-frame"
        src="https://www.google.com/maps?q=Via+Merulana+257,+00185+Roma&output=embed"
        allowfullscreen="" loading="lazy"></iframe>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  <script>
    // Language toggle
    const langSelect = document.getElementById('langSelect');
    langSelect.addEventListener('change', () => {
      document.querySelectorAll('.lang').forEach(el => el.style.display = 'none');
      document.querySelectorAll('.lang-' + langSelect.value).forEach(el => el.style.display = 'inline');
    });
    // Populate dropdowns...
    const dati = {
      "iPhone XR": {"64 GB":70,"128 GB":100,"256 GB":120},
      "iPhone XS": {"64 GB":80,"256 GB":100,"512 GB":130},
      // ... (rest omitted for brevity; include full dati as before)
    };
    const modelloEl = document.getElementById('modello');
    const capacitaEl = document.getElementById('capacita');
    const coloreEl = document.getElementById('colore');
    const prezzoEl = document.getElementById('prezzo');
    Object.keys(dati).forEach(model => {
      const opt = document.createElement('option'); opt.value=model; opt.textContent=model;
      modelloEl.appendChild(opt);
    });
    modelloEl.onchange = () => {
      capacitaEl.innerHTML = '<option value="">—</option>'; capacitaEl.disabled = true;
      coloreEl.innerHTML = '<option value="">—</option>'; coloreEl.disabled = true;
      prezzoEl.textContent = '€0,00';
      const caps = dati[modelloEl.value];
      if(caps) { Object.keys(caps).forEach(cap => {
          const opt = document.createElement('option'); opt.value=cap; opt.textContent=cap;
          capacitaEl.appendChild(opt);
        });
        capacitaEl.disabled = false;
      }
    };
    capacitaEl.onchange = () => {
      coloreEl.innerHTML = '<option value="">—</option>'; coloreEl.disabled = true;
      prezzoEl.textContent = '€0,00';
      Object.keys({"Space Gray":0,"Silver":0,"Gold":0,"Black":0,"White":0,"Blue":0,"Red":0,"Green":0,"Yellow":0,"Coral":0}).forEach(col => {
        const opt = document.createElement('option'); opt.value=col; opt.textContent=col;
        coloreEl.appendChild(opt);
      });
      coloreEl.disabled = false;
    };
    coloreEl.onchange = () => {
      const base = dati[modelloEl.value][capacitaEl.value]||0;
      prezzoEl.textContent = '€'+base.toFixed(2).replace('.',',');
      document.getElementById('hidden-modello').value = modelloEl.value;
      document.getElementById('hidden-capacita').value = capacitaEl.value;
      document.getElementById('hidden-colore').value = coloreEl.value;
      document.getElementById('hidden-prezzo').value = base.toFixed(2).replace('.',',');
    };
    // Form submit handler
    document.getElementById('bookingForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const form = e.target, data = new FormData(form);
      const date = data.get('date'), time = data.get('time');
      data.set('dateTime', date+' '+time);
      fetch('/', {method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded'},
        body:new URLSearchParams(data).toString()})
      .then(() => {
        form.style.display='none';
        const details = `
          <strong>${data.get('nome')}</strong><br>
          Model: ${data.get('modello')}<br>
          Capacity: ${data.get('capacita')}<br>
          Color: ${data.get('colore')}<br>
          Price: €${data.get('prezzo')}<br>
          ${langSelect.value==='it'?'Data/Ora':'Date/Time'}: ${date} ${time}
        `;
        document.getElementById('confDetails').innerHTML = details;
        document.getElementById('confirmation').style.display='block';
        document.getElementById('downloadPdf').onclick = () => {
          html2pdf().from(document.getElementById('confirmation')).save('prenotazione.pdf');
        };
        const msg = encodeURIComponent((langSelect.value==='it'?`iFix: ho ottenuto ${data.get('prezzo')} per il mio iPhone ${data.get('modello')} ${data.get('capacita')} ${data.get('colore')}`:`iFix: I got ${data.get('prezzo')} for my iPhone ${data.get('modello')} ${data.get('capacita')} ${data.get('colore')}`));
        document.getElementById('whatsappShare').href = `https://wa.me/?text=${msg}`;
        document.getElementById('facebookShare').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(location.href)}&quote=${msg}`;
      });
    });
  </script>
</body>
</html>